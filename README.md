# 抖音主页作品解析下载

> **版本：V3.1 · 作者：YanRuYing**  
> 自动解析并批量下载抖音主页的全部作品，包括视频、图集图片与实况图片（Live Photo）。  
> 支持命令行与 PyQt6 图形界面两种运行方式。  
> 项目开源，仅供学习研究使用。

---

## 📘 一、项目简介

「抖音主页作品解析下载」是一款用于**批量抓取抖音主页内容**的工具。  
它能够：

- 自动解析主页短链或长链；
- 获取用户全部作品（视频、图集、实况图）；
- 支持多线程高速下载；
- 自动跳过已存在文件，断点续传；
- 图形界面可视化操作，内置日志与进度条。

---

## ⚙️ 二、环境准备

### 1. 系统要求

- Windows / macOS / Linux 均可
- Python 版本 ≥ 3.9

### 2. 安装依赖

```bash
pip install requests tqdm PyQt6
```

> 💡 若你只使用命令行模式，可省略安装 PyQt6。

---

## 📁 三、文件结构说明

```
📂 抖音主页作品解析下载/
├── 抖音主页作品解析下载.py         # 主程序（命令行 + GUI）
├── config.ini                    # 自动保存 Cookie 与下载路径
├── douyin_cookie.txt             # Cookie 快速保存文件(旧版，已废弃)
└── README.md                     # 使用说明文档
```

---

## 🚀 四、使用方法

### ▶️ 方式一：命令行模式

1️⃣ 运行脚本  

```bash
python 抖音主页作品解析下载.py --cli 
```

2️⃣ 按提示输入：

- 抖音主页链接（支持短链和长链）
- 登录后复制的 Cookie（网页版抖音）
- 下载路径（可直接回车使用当前目录）
- 下载线程数（默认 8）

3️⃣ 下载完成后：

- 文件将保存在「昵称」命名的文件夹中；
- 日志文件会记录所有已成功下载的文件。

---

### 🪟 方式二：图形界面模式

运行：

```bash
python 抖音主页作品解析下载.py
```

图形界面提供：

- 输入主页链接与 Cookie；
- 一键【获取作品】；
- 复选选择要下载的内容；
- 【开始下载】按钮启动；
- 实时日志与下载进度显示。

---

## 🔍 五、运行步骤与实现原理

| 步骤           | 功能                     | 实现原理                                                     |
| -------------- | ------------------------ | ------------------------------------------------------------ |
| 1️⃣ 链接解析     | 支持短链与长链解析       | 通过正则匹配 `/user/` 或 `sec_user_id` 提取用户唯一 ID；短链使用 `requests.get(allow_redirects=True)` 自动展开重定向。 |
| 2️⃣ Cookie 验证  | 确保登录状态有效         | 请求主页 HTML 判断是否包含“未登录”关键字，以此判定 Cookie 是否有效。 |
| 3️⃣ 用户信息获取 | 获取昵称与作品数         | 调用接口：`https://www.douyin.com/aweme/v1/web/user/profile/other/?sec_user_id=...` |
| 4️⃣ 作品抓取     | 分页获取所有作品 JSON    | 使用接口：`/aweme/v1/web/aweme/post/`，自动分页循环，带进度输出。 |
| 5️⃣ 任务解析     | 分类出视频、图片、实况图 | 遍历 `aweme_list`，识别 `video` 与 `images` 字段，区分普通图片与实况图（含视频字段）。 |
| 6️⃣ 文件命名     | 生成安全唯一文件名       | 清理非法字符、过长名称自动截断，若重复则附加时间戳与哈希值。 |
| 7️⃣ 多线程下载   | 高速批量保存文件         | `ThreadPoolExecutor` + `tqdm` 实现并发下载与进度显示。       |
| 8️⃣ 日志与去重   | 避免重复下载             | 每次下载完成后写入日志文件，下次启动时自动跳过已存在任务。   |
| 9️⃣ 自动重试     | 提高成功率               | 对下载失败的任务自动重试最多 3 次。                          |
| 🔟 GUI 通信机制 | PyQt6 实现异步刷新       | 使用 `pyqtSignal` 信号槽机制，将下载进度、日志、任务状态异步发送到界面线程显示。 |

---

## ⚙️ 六、配置文件与日志机制

### 📄 config.ini

用于保存上次的下载路径与 Cookie：

```ini
[main]
path = D:\DouyinDownloads
cookie = your_cookie_here
```

---

## 💡 七、常见问题（FAQ）

### Q1：提示 Cookie 无效？

> 1.请重新打开网页版抖音，按 F12 → Network → Headers → 复制完整 Cookie 值。
>
> 2.检查是不是网络代理没关

### Q2：程序显示 “未获取到任何作品”？

> 1.用户可能设置了隐私权限或 Cookie 未登录，检查 `sec_user_id` 是否正确。
>
> 2.检查是不是主页链接，不支持视频分享链接

### Q3：能否只下载视频或图片？

> 可以，在 GUI 中仅勾选目标项；命令行版本会自动分类下载。

---

## 🧠 八、程序架构概览

```
┌────────────────────────────┐
│        用户输入链接        │
└────────────┬──────────────┘
             ↓
      解析 sec_user_id
             ↓
       验证 Cookie
             ↓
      获取用户资料信息
             ↓
       分页抓取作品 JSON
             ↓
        解析媒体链接
             ↓
       构建下载任务列表
             ↓
        多线程下载执行
             ↓
        	去重
```

---

## ⚠️ 九、免责声明

本项目仅用于个人学习与研究，严禁用于任何商业用途或违法行为。  
使用本工具所产生的任何风险由使用者自行承担。

---

## 📝 十、开源协议

本项目基于 **MIT License** 开源，欢迎二次开发与贡献改进。

---

## ❤️ 十一、作者信息

作者：**YanRuYing**  
项目名称：**抖音主页作品解析下载**  
若你觉得本项目有帮助，请在 GitHub 点亮 ⭐ 支持！

---
